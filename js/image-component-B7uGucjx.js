import{r as l,a as F,t as se,s as ne,Q as G,b as K,j as i,B as oe,T as U,c as ie,u as ae,o as le,d as ce,$ as T,E as H,e as B,I as q,f as ue,U as de,P as ge,Y as I,O as me,A as fe,D as he,g as pe,h as be,i as we,F as xe,k as ye,J as Ee,l as ve,m as Ce,L as ze,n as Re,C as je,p as J}from"./index-Dn3EcYzM.js";const Q=[["Cat","rgb(125, 50, 0)"],["Dog","rgb(100, 0, 0)"],["Rabbit","rgb(150, 0, 0)"],["Frog","rgb(200, 0, 0)"],["Fox","rgb(200, 75, 0)"],["Hedgehog","rgb(0, 75, 0)"],["Pigeon","rgb(0, 125, 0)"],["Squirrel","rgb(75, 100, 0)"],["Bear","rgb(125, 100, 0)"],["Tiger","rgb(0, 0, 150)"],["Leopard","rgb(0, 0, 200)"],["Zebra","rgb(0, 0, 250)"],["Wolf","rgb(0, 100, 150)"],["Owl","rgb(0, 100, 100)"],["Gull","rgb(100, 0, 100)"],["Squid","rgb(150, 0, 150)"]],V=Q[Math.floor(Math.random()*Q.length)],ke=l.createContext(null);function De(){return{color:V[1],isCollabActive:!1,name:V[0],yjsDocMap:new Map}}De();function Me({initialEditor:n,children:C,initialNodes:h,initialTheme:j,skipCollabChecks:L,skipEditableListener:k}){const P=l.useRef(!1),y=l.useContext(F);y==null&&(function(f,...D){const t=new URL("https://lexical.dev/docs/error"),x=new URLSearchParams;x.append("code",f);for(const a of D)x.append("v",a);throw t.search=x.toString(),Error(`Minified Lexical error #${f}; visit ${t.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)})(9);const[p,{getTheme:W}]=y,z=l.useMemo(()=>{const f=j||W()||void 0,D=se(y,f);f!==void 0&&(n._config.theme=f),n._parentEditor=n._parentEditor||p;const t=n._createEditorArgs,x=t&&t.namespace;if(h){x||(n._config.namespace=p._config.namespace);for(let a of h){let M=null,b=null;if(typeof a!="function"){const s=a;a=s.replace,M=s.with,b=s.withKlass||null}const e=ne(n,a.getType());n._nodes.set(a.getType(),{exportDOM:e?e.exportDOM:void 0,klass:a,replace:M,replaceWithKlass:b,sharedNodeState:K(a),transforms:G(a)})}}else if(t&&t.nodes)x||(n._config.namespace=p._config.namespace);else{const a=n._nodes=new Map(p._nodes);x||(n._config.namespace=p._config.namespace);for(const[M,b]of a)n._nodes.set(M,{exportDOM:b.exportDOM,klass:b.klass,replace:b.replace,replaceWithKlass:b.replaceWithKlass,sharedNodeState:K(b.klass),transforms:G(b.klass)})}return[n,D]},[]),S=l.useContext(ke),{isCollabActive:d,yjsDocMap:E}=S??{},_=L||P.current||E&&E.has(n.getKey());return l.useEffect(()=>{_&&(P.current=!0)},[_]),l.useEffect(()=>{if(!k){const f=D=>n.setEditable(D);return f(p.isEditable()),p.registerEditableListener(f)}},[n,p,k]),i.jsx(F.Provider,{value:z,children:!d||_?C:null})}function O(n,C,h){return Math.min(Math.max(n,C),h)}const o={east:1,north:8,south:2,west:4};function Ne({onResizeStart:n,onResizeEnd:C,buttonRef:h,imageRef:j,maxWidth:L,editor:k,showCaption:P,setShowCaption:y,captionsEnabled:p}){const W=l.useRef(null),z=l.useRef({priority:"",value:"default"}),S=l.useRef({currentHeight:0,currentWidth:0,direction:0,isResizing:!1,ratio:0,startHeight:0,startWidth:0,startX:0,startY:0}),d=k.getRootElement(),E=L||(d!==null?d.getBoundingClientRect().width-20:100),_=d!==null?d.getBoundingClientRect().height-20:100,f=100,D=100,t=e=>{const s=e===o.east||e===o.west,r=e===o.north||e===o.south,R=e&o.north&&e&o.west||e&o.south&&e&o.east,w=s?"ew":r?"ns":R?"nwse":"nesw";d!==null&&d.style.setProperty("cursor",`${w}-resize`,"important"),document.body!==null&&(document.body.style.setProperty("cursor",`${w}-resize`,"important"),z.current.value=document.body.style.getPropertyValue("-webkit-user-select"),z.current.priority=document.body.style.getPropertyPriority("-webkit-user-select"),document.body.style.setProperty("-webkit-user-select","none","important"))},x=()=>{d!==null&&d.style.setProperty("cursor","text"),document.body!==null&&(document.body.style.setProperty("cursor","default"),document.body.style.setProperty("-webkit-user-select",z.current.value,z.current.priority))},a=(e,s)=>{if(!k.isEditable())return;const r=j.current,R=W.current;if(r!==null&&R!==null){e.preventDefault();const{width:w,height:v}=r.getBoundingClientRect(),c=U(r),u=S.current;u.startWidth=w,u.startHeight=v,u.ratio=w/v,u.currentWidth=w,u.currentHeight=v,u.startX=e.clientX/c,u.startY=e.clientY/c,u.isResizing=!0,u.direction=s,t(s),n(),R.classList.add("touch-action-none"),r.style.height=`${v}px`,r.style.width=`${w}px`,document.addEventListener("pointermove",M),document.addEventListener("pointerup",b)}},M=e=>{const s=j.current,r=S.current,R=r.direction&(o.east|o.west),w=r.direction&(o.south|o.north);if(s!==null&&r.isResizing){const v=U(s);if(R&&w){let c=Math.floor(r.startX-e.clientX/v);c=r.direction&o.east?-c:c;const u=O(r.startWidth+c,f,E),A=u/r.ratio;s.style.width=`${u}px`,s.style.height=`${A}px`,r.currentHeight=A,r.currentWidth=u}else if(w){let c=Math.floor(r.startY-e.clientY/v);c=r.direction&o.south?-c:c;const u=O(r.startHeight+c,D,_);s.style.height=`${u}px`,r.currentHeight=u}else{let c=Math.floor(r.startX-e.clientX/v);c=r.direction&o.east?-c:c;const u=O(r.startWidth+c,f,E);s.style.width=`${u}px`,r.currentWidth=u}}},b=()=>{const e=j.current,s=S.current,r=W.current;if(e!==null&&r!==null&&s.isResizing){const R=s.currentWidth,w=s.currentHeight;s.startWidth=0,s.startHeight=0,s.ratio=0,s.startX=0,s.startY=0,s.currentWidth=0,s.currentHeight=0,s.isResizing=!1,r.classList.remove("touch-action-none"),x(),C(R,w),document.removeEventListener("pointermove",M),document.removeEventListener("pointerup",b)}};return i.jsxs("div",{ref:W,children:[!P&&p&&i.jsx(oe,{className:"image-caption-button absolute bottom-1 left-1/2 -translate-x-1/2",ref:h,variant:"outline",onClick:()=>{y(!P)},children:"Add Caption"}),i.jsx("div",{className:"image-resizer image-resizer-n bg-primary absolute -top-2.5 left-1/2 h-2 w-2 -translate-x-1/2 cursor-ns-resize",onPointerDown:e=>{a(e,o.north)}}),i.jsx("div",{className:"image-resizer image-resizer-ne bg-primary absolute -top-2.5 -right-2.5 h-2 w-2 cursor-nesw-resize",onPointerDown:e=>{a(e,o.north|o.east)}}),i.jsx("div",{className:"image-resizer image-resizer-e bg-primary absolute top-1/2 -right-2.5 h-2 w-2 -translate-y-1/2 cursor-ew-resize",onPointerDown:e=>{a(e,o.east)}}),i.jsx("div",{className:"image-resizer image-resizer-se bg-primary absolute -right-2.5 -bottom-2.5 h-2 w-2 cursor-nwse-resize",onPointerDown:e=>{a(e,o.south|o.east)}}),i.jsx("div",{className:"image-resizer image-resizer-s bg-primary absolute -bottom-2.5 left-1/2 h-2 w-2 -translate-x-1/2 cursor-ns-resize",onPointerDown:e=>{a(e,o.south)}}),i.jsx("div",{className:"image-resizer image-resizer-sw bg-primary absolute -bottom-2.5 -left-2.5 h-2 w-2 cursor-nesw-resize",onPointerDown:e=>{a(e,o.south|o.west)}}),i.jsx("div",{className:"image-resizer image-resizer-w bg-primary absolute top-1/2 -left-2.5 h-2 w-2 -translate-y-1/2 cursor-ew-resize",onPointerDown:e=>{a(e,o.west)}}),i.jsx("div",{className:"image-resizer image-resizer-nw bg-primary absolute -top-2.5 -left-2.5 h-2 w-2 cursor-nwse-resize",onPointerDown:e=>{a(e,o.north|o.west)}})]})}const X=new Set,Z=ie("RIGHT_CLICK_IMAGE_COMMAND");function Pe(n){if(!X.has(n))throw new Promise(C=>{const h=new Image;h.src=n,h.onload=()=>{X.add(n),C(null)},h.onerror=()=>{X.add(n)}})}function Se({altText:n,className:C,imageRef:h,src:j,width:L,height:k,maxWidth:P,onError:y}){return Pe(j),i.jsx("img",{className:C||void 0,src:j,alt:n,ref:h,style:{height:k,maxWidth:P,width:L},onError:y,draggable:"false"})}function _e(){return i.jsx("img",{src:"",style:{height:200,opacity:.2,width:200},draggable:"false"})}function $e({src:n,altText:C,nodeKey:h,width:j,height:L,maxWidth:k,resizable:P,showCaption:y,caption:p,captionsEnabled:W}){const z=l.useRef(null),S=l.useRef(null),[d,E,_]=ae(h),[f,D]=l.useState(!1),[t]=le(),[x,a]=l.useState(null),M=l.useRef(null),[b,e]=l.useState(!1),s=ce(),r=l.useCallback(g=>{const m=T();return d&&H(m)&&(g.preventDefault(),t.update(()=>{m.getNodes().forEach($=>{B($)&&$.remove()})})),!1},[t,d]),R=l.useCallback(g=>{const m=T(),N=S.current;if(d&&H(m)&&m.getNodes().length===1){if(y)return q(null),g.preventDefault(),p.focus(),!0;if(N!==null&&N!==document.activeElement)return g.preventDefault(),N.focus(),!0}return!1},[p,d,y]),w=l.useCallback(g=>M.current===p||S.current===g.target?(q(null),t.update(()=>{E(!0);const m=t.getRootElement();m!==null&&m.focus()}),!0):!1,[p,t,E]),v=l.useCallback(g=>{const m=g;return f?!0:m.target===z.current?(m.shiftKey?E(!d):(_(),E(!0)),!0):!1},[f,d,E,_]),c=l.useCallback(g=>{t.getEditorState().read(()=>{const m=T();g.target.tagName==="IMG"&&ue(m)&&m.getNodes().length===1&&t.dispatchCommand(Z,g)})},[t]);l.useEffect(()=>{let g=!0;const m=t.getRootElement(),N=de(t.registerUpdateListener(({editorState:$})=>{g&&a($.read(()=>T()))}),t.registerCommand(we,($,re)=>(M.current=re,!1),I),t.registerCommand(be,v,I),t.registerCommand(Z,v,I),t.registerCommand(pe,$=>$.target===z.current?($.preventDefault(),!0):!1,I),t.registerCommand(he,r,I),t.registerCommand(fe,r,I),t.registerCommand(me,R,I),t.registerCommand(ge,w,I));return m?.addEventListener("contextmenu",c),()=>{g=!1,N(),m?.removeEventListener("contextmenu",c)}},[_,t,f,d,h,r,R,w,v,c,E]);const u=()=>{t.update(()=>{const g=J(h);B(g)&&g.setShowCaption(!0)})},A=(g,m)=>{setTimeout(()=>{D(!1)},200),t.update(()=>{const N=J(h);B(N)&&N.setWidthAndHeight(g,m)})},ee=()=>{D(!0)},te=d&&H(x)&&!f,Y=(d||f)&&s;return i.jsx(l.Suspense,{fallback:null,children:i.jsxs(i.Fragment,{children:[i.jsx("div",{draggable:te,children:b?i.jsx(_e,{}):i.jsx(Se,{className:`max-w-full cursor-default ${Y?`${H(x)?"draggable cursor-grab active:cursor-grabbing":""} focused ring-primary ring-2 ring-offset-2`:null}`,src:n,altText:C,imageRef:z,width:j,height:L,maxWidth:k,onError:()=>e(!0)})}),y&&i.jsx("div",{className:"image-caption-container absolute right-0 bottom-1 left-0 m-0 block min-w-[100px] overflow-hidden border-t bg-white/90 p-0",children:i.jsxs(Me,{initialEditor:p,initialNodes:[xe,ye,Ee],children:[i.jsx(ve,{}),i.jsx(Ce,{}),i.jsx(ze,{contentEditable:i.jsx(je,{className:"ImageNode__contentEditable user-select-text word-break-break-word caret-primary relative block min-h-5 w-[calc(100%-20px)] cursor-text resize-none border-0 p-2.5 text-sm whitespace-pre-wrap outline-none",placeholderClassName:"ImageNode__placeholder text-sm text-muted-foreground overflow-hidden absolute top-2.5 left-2.5 pointer-events-none text-ellipsis user-select-none whitespace-nowrap inline-block",placeholder:"Enter a caption..."}),ErrorBoundary:Re})]})}),P&&H(x)&&Y&&i.jsx(Ne,{showCaption:y,setShowCaption:u,editor:t,buttonRef:S,imageRef:z,maxWidth:k,onResizeStart:ee,onResizeEnd:A,captionsEnabled:!b&&W})]})})}export{Z as RIGHT_CLICK_IMAGE_COMMAND,$e as default};
